jobs:
  build:
    steps:
      - name: semantic-release
        outputAs: releases
        job: ./semantic-releases.yml
      - name: versions
        dispatch: get-version
        with:
          path: $($.location)
        outputAs: versions
        foreach: $(build.releases.build.workspaces)
      - name: tag
        foreach: $(build.versions)
        foreach-strategy: wait-for-previous
        run:
          - git
          - tag
          - -a
          - $($index)@$($)
          - -m
          - Publish
      - name: push
        run: git push origin --tags
      - name: publish
        foreach: $(build.versions)
        run: yarn workspaces foreach --no-private npm publish --tolerate-republish
